{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TeknoGrub | Menu</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="{% static 'css/menu.css' %}" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      /* =========================================
         GLOBAL FONT OVERRIDES
         (To match Favorites Page)
      ========================================= */
      body {
        font-family: 'Inter', sans-serif; /* Primary font set to Inter */
      }

      /* Ensure Headers and Bold text use Inter Bold */
      h1, h2, h3, h4,
      .logo h1,
      .sidebar .name,
      .food-name,
      .basket-header,
      .qty-box,
      .popup-title,
      .section-title {
        font-family: 'Inter', sans-serif;
        font-weight: 700;
      }

      /* =========================================
         1. MODAL (ITEM DETAIL POPUP) STYLES
      ========================================= */

      /* The Background Overlay */
      .modal-overlay {
        display: none; /* Hidden by default */
        position: fixed;
        z-index: 2000; /* Higher than basket */
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.6); /* Dimmed background */
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(3px);
      }

      /* When active, show flex to center the content */
      .modal-overlay.active {
        display: flex;
      }

      /* The Detail Card Popup */
      .detail-card-popup {
        background: white;
        width: 90%;
        max-width: 500px;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        position: relative;
        animation: popIn 0.3s ease;
        font-family: 'Inter', sans-serif; /* Ensure popup uses Inter */
      }

      @keyframes popIn {
        from { transform: scale(0.8); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
      }

      /* Close Button */
      .close-modal-btn {
        position: absolute;
        top: 15px;
        left: 15px;
        background: #F4C430;
        color: #5d0c1d;
        width: 35px;
        height: 35px;
        border-radius: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-weight: bold;
        font-size: 1.2rem;
        z-index: 10;
        transition: transform 0.2s;
      }
      .close-modal-btn:hover { transform: scale(1.1); }

      /* Popup Content Styles */
      .popup-image { width: 100%; height: 200px; object-fit: cover; }
      .popup-content { padding: 25px; max-height: 60vh; overflow-y: auto; } /* Scrollable if tall */

      .popup-header-row { display: flex; justify-content: space-between; align-items: start; margin-bottom: 5px; }
      .popup-title { font-size: 1.5rem; color: #5d0c1d; font-weight: 700; margin: 0; }
      .popup-price { font-size: 1.2rem; color: #888; text-decoration: underline; font-weight: 600; }
      .popup-category { color: #666; font-style: italic; margin-bottom: 15px; font-size: 0.9rem; }
      .popup-desc { color: #777; font-size: 0.9rem; line-height: 1.5; margin-bottom: 20px; }

      /* Ingredients & Addons */
      .section-title { color: #5d0c1d; font-weight: 700; font-size: 1rem; margin-bottom: 10px; margin-top: 15px;}
      .ingredients-box { background: #e0e0e0; border-radius: 8px; padding: 10px; font-size: 0.9rem; color: #5d0c1d; }

      .addon-row { background: #f9f9f9; padding: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
      .checkbox-label { display: flex; align-items: center; gap: 10px; font-weight: 500; color: #5d0c1d; cursor: pointer; }
      .note-area { width: 100%; background: #ddd; border: none; border-radius: 8px; padding: 10px; height: 60px; resize: none; font-family: 'Inter', sans-serif;}

      /* Footer Controls */
      .popup-footer-row { display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #eee; padding-top: 20px; margin-top: 10px;}
      .counter-box { display: flex; align-items: center; gap: 10px; }
      .qty-popup-btn { background: #F4C430; border: none; width: 30px; height: 30px; border-radius: 5px; font-weight: bold; cursor: pointer; color: #5d0c1d; }
      .qty-display { border: 1px solid #ccc; padding: 5px 10px; border-radius: 5px; font-weight: bold; min-width: 30px; text-align: center; }
      .add-popup-btn { background: #F4C430; color: #5d0c1d; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 20px; font-family: 'Inter', sans-serif; }
      .add-popup-btn:hover { background: #e0b120; }


      /* =========================================
         2. EXISTING MENU STYLES
      ========================================= */

      /* Make the cards clickable */
      .card { cursor: pointer; transition: transform 0.2s; }
      .card:hover { transform: translateY(-5px); }

      /* Floating Basket & Sidebar */
      .floating-basket { position: fixed; bottom: 30px; right: 30px; width: 70px; height: 70px; cursor: pointer; z-index: 999; transition: transform 0.2s ease; filter: drop-shadow(0px 4px 6px rgba(0,0,0,0.3)); }
      .floating-basket:hover { transform: scale(1.1); }
      .basket-overlay { position: fixed; top: 0; right: -100%; width: 400px; max-width: 100%; height: 100vh; background: #fff; box-shadow: -5px 0 15px rgba(0,0,0,0.2); transition: right 0.3s ease-in-out; z-index: 1000; display: flex; flex-direction: column; font-family: 'Inter', sans-serif; }
      .basket-overlay.active { right: 0; }
      .basket-header { background: linear-gradient(to bottom, #F4C430 85%, #fff 100%); padding: 25px 20px; display: flex; align-items: center; gap: 15px; font-weight: bold; font-size: 1.3rem; color: #5d0c1d; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
      .basket-subheader { padding: 15px 20px 5px 20px; color: #5d0c1d; font-weight: bold; text-transform: uppercase; font-size: 0.9rem; letter-spacing: 0.5px; }
      .basket-items { flex: 1; overflow-y: auto; padding: 10px 20px; }
      .basket-item-card { display: flex; gap: 15px; margin-bottom: 25px; position: relative; }
      .basket-item-img { width: 70px; height: 70px; border-radius: 12px; object-fit: cover; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
      .basket-item-details { flex: 1; display: flex; flex-direction: column; }
      .basket-item-details h4 { margin: 0; font-size: 1.1rem; color: #5d0c1d; font-weight: bold; }
      .basket-item-details p { margin: 2px 0; font-size: 0.8rem; color: #777; }
      .edit-btn { font-size: 0.9rem; font-weight: bold; color: #5d0c1d; cursor: pointer; margin-top: auto; }
      .item-price { position: absolute; top: 0; right: 0; font-size: 0.85rem; color: #888; text-decoration: underline; }
      .basket-controls { position: absolute; bottom: 0; right: 0; display: flex; align-items: center; gap: 8px; }
      .qty-box { border: 2px solid #F4C430; border-radius: 8px; padding: 2px 10px; font-weight: bold; color: #5d0c1d; font-size: 1rem; background: white; }
      .qty-btn { background: #F4C430; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; color: #5d0c1d; font-weight: bold; transition: background 0.2s; }
      .basket-footer { padding: 25px; background: #fff; border-top-left-radius: 20px; border-top-right-radius: 20px; box-shadow: 0 -5px 15px rgba(0,0,0,0.05); }
      .total-section { display: flex; justify-content: space-between; align-items: baseline; font-weight: bold; margin-bottom: 20px; }
      .total-label { font-size: 1.2rem; color: #5d0c1d; }
      .total-amount { font-size: 1.1rem; color: #5d0c1d; text-decoration: underline; font-style: italic; }
      .checkout-btn { width: 100%; background: #F4C430; border: none; padding: 15px; border-radius: 12px; font-size: 1.1rem; font-weight: bold; color: #5d0c1d; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; text-decoration: none; box-shadow: 0 4px 6px rgba(244, 196, 48, 0.3); font-family: 'Inter', sans-serif;}
      .checkout-btn:hover { background-color: #e0b120; }
    </style>
  </head>

  <body>
    <header class="header">
      <div class="logo">
        <h1>TEKNO<span>GRUB</span></h1>
      </div>
      <div class="header-icons">
        <i class="fa-solid fa-bell"></i>
        <i class="fa-solid fa-bars"></i>
      </div>
    </header>

    <div class="sidebar">
      <div class="user">
        <p class="name">Libeth Bileth</p>
        <p class="id">11-1111-111</p>
      </div>

        <div class="canteen-selection">
          <select id="canteen" name="canteen">
            <option value="main">Main Canteen</option>
            <option value="elementary">Elementary Canteen</option>
            <option value="rtl">RTL Canteen</option>
          </select>
        </div>

      <div class="menu-section">
        <nav>
          <ul>
            <li class="active">
                        <a href="{% url 'menu' %}">
                            <i class="fa-solid fa-utensils"></i> Menu
                        </a>
                    </li>

                    <li>
                        <a href="{% url 'favorites' %}">
                            <i class="fa-solid fa-star"></i> Favorites
                        </a>
                    </li>
            <li><i class="fa-solid fa-tag"></i> Promos</li>
            <li><i class="fa-solid fa-clock-rotate-left"></i> History</li>
            <li><i class="fa-solid fa-gear"></i> Settings</li>
          </ul>
        </nav>
      </div>
    </div>

    <main class="main-content">
      <div class="topbar">
        <input type="text" placeholder="Search..." />
        <button><i class="fa-solid fa-magnifying-glass"></i> Search</button>
      </div>

      <section class="popular">
        <h3>Most Popular</h3>
        <div class="popular-holder">
          <div class="scroll-container">

            <div class="card" onclick="openItemModal('Burger Steak', 50.00, '{% static '/images/food.png' %}', 'Savory beef patty with mushroom gravy.')">
              <div class="favorite"><i class="fa-solid fa-star"></i></div>
              <img src="{% static '/images/food.png' %}" alt="Burger Steak" />
              <div class="details">
                <p class="food-name">Burger Steak</p>
                <p class="price">₱ 50.00</p>
                <button class="add-cart"><i class="fa-solid fa-plus"></i></button>
              </div>
            </div>

            <div class="card" onclick="openItemModal('Pork Humba', 80.00, '{% static '/images/food (2).png' %}', 'Sweet braised pork belly.')">
              <div class="favorite"><i class="fa-solid fa-star"></i></div>
              <img src="{% static '/images/food (2).png' %}" alt="Pork Humba" />
              <div class="details">
                <p class="food-name">Pork Humba</p>
                <p class="price">₱ 80.00</p>
                <button class="add-cart"><i class="fa-solid fa-plus"></i></button>
              </div>
            </div>

             <div class="card" onclick="openItemModal('Chicken Inasal', 90.00, '{% static '/images/food.png' %}', 'Grilled chicken with lemongrass and annatto.')">
              <div class="favorite"><i class="fa-solid fa-star"></i></div>
              <img src="{% static '/images/food.png' %}" alt="Chicken Inasal" />
              <div class="details">
                <p class="food-name">Chicken Inasal</p>
                <p class="price">₱ 90.00</p>
                <button class="add-cart"><i class="fa-solid fa-plus"></i></button>
              </div>
            </div>

          </div>
        </div>
      </section>

      <section class="categorical-dishes">
        <div class="category-header">
          <button class="arrow left"><i class="fa-solid fa-chevron-left"></i></button>
          <div class="categories">
            <button class="category">Rice</button>
            <button class="category active">Dish</button>
            <button class="category">Others</button>
          </div>
          <button class="arrow right"><i class="fa-solid fa-chevron-right"></i></button>
        </div>

        <div class="category-holder">
          <div class="dish-grid">

             <div class="card" onclick="openItemModal('Burglar Steak', 500.00, '{% static '/images/food (2).png' %}', 'Premium steak that steals the show.')">
              <div class="favorite"><i class="fa-solid fa-star"></i></div>
              <img src="{% static '/images/food (2).png' %}" alt="Burglar Steak">
              <div class="details">
                <p class="food-name">Burglar Steak</p>
                <p class="price">₱ 500.00</p>
                <button class="add-cart"><i class="fa-solid fa-plus"></i></button>
              </div>
            </div>

             <div class="card" onclick="openItemModal('Pork Humba', 69.00, '{% static '/images/food.png' %}', 'Classic pork humba.')">
                <div class="favorite"><i class="fa-solid fa-star"></i></div>
                <img src="{% static '/images/food.png' %}" alt="Pork Humba">
                <div class="details">
                  <p class="food-name">Pork Humba</p>
                  <p class="price">₱ 69.00</p>
                  <button class="add-cart"><i class="fa-solid fa-plus"></i></button>
                </div>
              </div>

            <div class="card" onclick="openItemModal('Chicken Inasal', 100.00, '{% static '/images/food (2).png' %}', 'Tasty grilled chicken.')">
                <div class="favorite"><i class="fa-solid fa-star"></i></div>
                <img src="{% static '/images/food (2).png' %}" alt="Chicken Inasal">
                <div class="details">
                <p class="food-name">Chicken Inasal</p>
                <p class="price">₱ 100.00</p>
                <button class="add-cart"><i class="fa-solid fa-plus"></i></button>
                </div>
            </div>

            <div class="card" onclick="openItemModal('Utan Tagalog', 50.00, '{% static '/images/food (7).png' %}', 'Fresh and healthy vegetable soup.')">
                <div class="favorite"><i class="fa-solid fa-star"></i></div>
                <img src="{% static '/images/food (7).png' %}" alt="Utan Tagalog">
                <div class="details">
                <p class="food-name">Utan Tagalog</p>
                <p class="price">₱ 50.00</p>
                <button class="add-cart"><i class="fa-solid fa-plus"></i></button>
                </div>
            </div>

            <div class="card" onclick="openItemModal('Sweet and Sour Fish', 80.00, '{% static '/images/food.png' %}', 'Crispy fish fillet in tangy sauce.')">
                <div class="favorite"><i class="fa-solid fa-star"></i></div>
                <img src="{% static '/images/food.png' %}" alt="Sweet and Sour Fish">
                <div class="details">
                <p class="food-name">Sweet and Sour Fish</p>
                <p class="price">₱ 80.00</p>
                <button class="add-cart"><i class="fa-solid fa-plus"></i></button>
                </div>
            </div>

            <div class="card" onclick="openItemModal('BBQ ko <3', 143.00, '{% static '/images/food (10).png' %}', 'Grilled pork skewers with love.')">
                <div class="favorite"><i class="fa-solid fa-star"></i></div>
                <img src="{% static '/images/food (10).png' %}" alt="BBQ ko <3">
                <div class="details">
                <p class="food-name">BBQ ko &lt;3</p>
                <p class="price">₱ 143.00</p>
                <button class="add-cart"><i class="fa-solid fa-plus"></i></button>
                </div>
            </div>

          </div>
        </div>
      </section>
    </main>

    <img src="{% static 'images/basket_icon.png' %}" alt="Basket" class="floating-basket" id="basketTrigger" onclick="toggleBasket()">

    <div id="basketSidebar" class="basket-overlay">
      <div class="basket-header">
        <i class="fa-solid fa-basket-shopping"></i>
        <span>My Basket</span>
      </div>

      <div class="basket-subheader">Main Canteen Order</div>

      <div class="basket-items">
        <div class="basket-item-card">
          <img src="{% static '/images/food (2).png' %}" class="basket-item-img" alt="Food">
          <div class="basket-item-details">
            <h4>Biggest beepstek</h4>
            <p>Take Out</p>
            <div class="edit-btn">Edit</div>
          </div>
          <div class="item-price">₱ 500,000.00</div>
          <div class="basket-controls">
            <span class="qty-box">1</span>
            <button class="qty-btn">+</button>
            <button class="qty-btn">-</button>
          </div>
        </div>

        <div class="basket-item-card">
          <img src="{% static '/images/food.png' %}" class="basket-item-img" alt="Food">
          <div class="basket-item-details">
            <h4>Stephen Kare</h4>
            <p>Dine In</p>
            <div class="edit-btn">Edit</div>
          </div>
          <div class="item-price">₱ 1 million dollars</div>
          <div class="basket-controls">
            <span class="qty-box">1</span>
            <button class="qty-btn">+</button>
            <button class="qty-btn">-</button>
          </div>
        </div>

        <div class="basket-item-card">
          <img src="{% static '/images/food (7).png' %}" class="basket-item-img" alt="Food">
          <div class="basket-item-details">
            <h4>Utan Tagalog</h4>
            <p>Dine In</p>
            <div class="edit-btn">Edit</div>
          </div>
          <div class="item-price">₱ 100.00</div>
          <div class="basket-controls">
            <span class="qty-box">2</span>
            <button class="qty-btn">+</button>
            <button class="qty-btn">-</button>
          </div>
        </div>
      </div>

      <div class="basket-footer">
        <div class="total-section">
          <span class="total-label">Total Amount:</span>
          <span class="total-amount">₱ 1,001,000,150.00</span>
        </div>
        <a href="{% url 'checkout' %}" class="checkout-btn">
          <i class="fa-solid fa-cash-register"></i> Proceed to Payment
        </a>
      </div>
    </div>


    <div id="itemDetailModal" class="modal-overlay">

        <div class="detail-card-popup">
            <div class="close-modal-btn" onclick="closeItemModal()"><i class="fa-solid fa-xmark"></i></div>

            <img src="" id="modalImg" class="popup-image" alt="Food">

            <div class="popup-content">
                <div class="popup-header-row">
                    <h1 class="popup-title" id="modalTitle">Dish Name</h1>
                    <span class="popup-price" id="modalPrice">₱ 0.00</span>
                </div>

                <p class="popup-category">Dish</p>

                <p class="popup-desc" id="modalDesc">
                    Description goes here...
                </p>

                <div class="section-title">Ingredients <i class="fa-solid fa-chevron-up"></i></div>
                <div class="ingredients-box">
                   Secret Ingredients...
                </div>

                <div class="section-title">Add-ons</div>
                <div class="addon-row">
                    <label class="checkbox-label">
                        <input type="checkbox" id="addon-rice" onchange="updateModalTotal()">
                        Rice
                    </label>
                    <span style="text-decoration: underline;">+ 15.00</span>
                </div>

                <div class="section-title">Note</div>
                <textarea class="note-area" placeholder="Special requests..."></textarea>

                <div class="popup-footer-row">
                    <div class="counter-box">
                        <strong>Amount:</strong>
                        <button class="qty-popup-btn" onclick="changeModalQty(-1)">-</button>
                        <div class="qty-display" id="modalQty">1</div>
                        <button class="qty-popup-btn" onclick="changeModalQty(1)">+</button>
                    </div>

                    <div>
                        <strong>Total:</strong>
                        <span class="total-display" id="modalTotalPrice">₱ 0.00</span>
                    </div>
                </div>

                <button class="add-popup-btn" onclick="closeItemModal()">Add to Basket</button>
            </div>
        </div>

    </div>


    <script>
      // --- BASKET LOGIC ---
      function toggleBasket() {
        const basket = document.getElementById('basketSidebar');
        basket.classList.toggle('active');
      }

      // Close basket when clicking outside
      document.addEventListener('click', function(event) {
          const basket = document.getElementById('basketSidebar');
          const trigger = document.getElementById('basketTrigger');

        // If sidebar is open AND click is NOT inside sidebar AND click is NOT on the trigger button
          if (basket.classList.contains('active') &&
              !basket.contains(event.target) &&
              !trigger.contains(event.target)) {
              basket.classList.remove('active');
          }
      });
      // --- ITEM DETAIL MODAL LOGIC ---
      let currentBasePrice = 0;
      let currentQty = 1;
      const addonPrice = 15.00;

      function openItemModal(name, price, imgSrc, desc) {
          // 1. Populate
          document.getElementById('modalTitle').innerText = name;
          document.getElementById('modalPrice').innerText = "₱ " + price.toFixed(2);
          document.getElementById('modalImg').src = imgSrc;
          document.getElementById('modalDesc').innerText = desc;

          // 2. Reset state
          currentBasePrice = price;
          currentQty = 1;
          document.getElementById('modalQty').innerText = currentQty;
          document.getElementById('addon-rice').checked = false;

          // 3. Update total calculation
          updateModalTotal();

          // 4. Show the modal
          document.getElementById('itemDetailModal').classList.add('active');
      }

      function closeItemModal() {
          document.getElementById('itemDetailModal').classList.remove('active');
      }

      function changeModalQty(change) {
          currentQty += change;
          if (currentQty < 1) currentQty = 1;
          document.getElementById('modalQty').innerText = currentQty;
          updateModalTotal();
      }

      function updateModalTotal() {
          let total = currentBasePrice * currentQty;

          // Check if rice added
          const hasRice = document.getElementById('addon-rice').checked;
          if (hasRice) {
              total += (addonPrice * currentQty);
          }

          document.getElementById('modalTotalPrice').innerText = "₱ " + total.toLocaleString('en-US', {minimumFractionDigits: 2});
      }

      // Close modal if clicking OUTSIDE the card (on the dark background)
      document.getElementById('itemDetailModal').addEventListener('click', function(e) {
          if (e.target === this) {
              closeItemModal();
          }
      });

      // Close basket when clicking outside
      document.addEventListener('click', function(event) {
        const basket = document.getElementById('basketSidebar');
        const trigger = document.getElementById('basketTrigger');

        if (basket.classList.contains('active') &&
            !basket.contains(event.target) &&
            !trigger.contains(event.target)) {
          basket.classList.remove('active');
        }
      });
    </script>
  </body>
</html>